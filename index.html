<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TickTick-Style Task Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4589F0;
      --primary-dark: #3A75D0;
      --secondary: #7BA8F5;
      --accent: #FF8F71;
      --light: #f8f9fa;
      --dark: #2d3436;
      --success: #43CC8C;
      --warning: #FFB84D;
      --danger: #FF5252;
      --gray: #F0F0F0;
      --dark-gray: #8E8E93;
    }

    [data-theme="dark"] {
      --primary: #5E9AF9;
      --primary-dark: #4B7ED6;
      --secondary: #8CB6F7;
      --accent: #FF9F81;
      --light: #1C1C1E;
      --dark: #F2F2F7;
      --success: #53DC9C;
      --warning: #FFC85D;
      --danger: #FF6262;
      --gray: #2C2C2E;
      --dark-gray: #8E8E93;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--light);
      color: var(--dark);
      transition: all 0.3s ease;
    }

    .task-checkbox:checked + .task-title {
      text-decoration: line-through;
      color: var(--dark-gray);
    }

    .priority-high {
      color: var(--danger);
    }

    .priority-medium {
      color: var(--warning);
    }

    .priority-low {
      color: var(--success);
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--dark-gray);
      border-radius: 3px;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50">
  <div id="app">
    <!-- Auth Section -->
    <div id="authSection" class="min-h-screen flex items-center justify-center p-6">
      <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-indigo-600 flex items-center justify-center gap-2">
            <i class="fas fa-check-circle"></i> TickTask
          </h1>
          <p class="text-gray-600 mt-2">Your personal task management solution</p>
        </div>
        
        <div id="authError" class="bg-red-100 text-red-700 p-3 rounded mb-4 hidden"></div>
        <div id="authSuccess" class="bg-green-100 text-green-700 p-3 rounded mb-4 hidden"></div>
        
        <div id="loginForm">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="loginEmail">Email</label>
            <input type="email" id="loginEmail" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your email">
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 mb-2" for="loginPassword">Password</label>
            <input type="password" id="loginPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your password">
          </div>
          <button id="loginBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition mb-4">
            Sign In
          </button>
          <div class="text-center">
            <a href="#" id="showSignup" class="text-indigo-600 hover:underline">Create an account</a> • 
            <a href="#" id="showReset" class="text-indigo-600 hover:underline ml-2">Forgot password?</a>
          </div>
        </div>
        
        <div id="signupForm" class="hidden">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="signupEmail">Email</label>
            <input type="email" id="signupEmail" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your email">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="signupPassword">Password</label>
            <input type="password" id="signupPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Create a password">
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 mb-2" for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Confirm your password">
          </div>
          <button id="signupBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition mb-4">
            Create Account
          </button>
          <div class="text-center">
            <a href="#" id="showLogin" class="text-indigo-600 hover:underline">Back to login</a>
          </div>
        </div>
        
        <div id="resetForm" class="hidden">
          <div class="mb-6">
            <label class="block text-gray-700 mb-2" for="resetEmail">Email</label>
            <input type="email" id="resetEmail" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your email">
          </div>
          <button id="resetBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition mb-4">
            Send Reset Link
          </button>
          <div class="text-center">
            <a href="#" id="showLoginFromReset" class="text-indigo-600 hover:underline">Back to login</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Main App Section -->
    <div id="appSection" class="hidden min-h-screen p-6">
      <div class="max-w-6xl mx-auto">
        <header class="flex items-center justify-between mb-6 bg-white p-4 rounded-lg shadow-sm">
          <div>
            <h1 class="text-2xl font-bold text-indigo-600 flex items-center gap-2">
              <i class="fas fa-check-circle"></i> TickTask
            </h1>
            <p class="text-sm text-gray-600" id="userEmailDisplay">Welcome!</p>
          </div>
          <div class="flex items-center gap-3">
            <input id="searchInput" placeholder="Search tasks..." class="px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200">
              <i class="fas fa-moon"></i>
            </button>
            <button id="logoutBtn" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <aside class="space-y-4">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold mb-3 text-lg">Views</h3>
              <nav class="flex flex-col gap-1">
                <button data-filter="all" class="filter-btn text-left px-3 py-2 rounded-lg hover:bg-indigo-50 text-indigo-600 flex items-center gap-2">
                  <i class="fas fa-list"></i> All Tasks
                </button>
                <button data-filter="inbox" class="filter-btn text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center gap-2">
                  <i class="fas fa-inbox"></i> Inbox
                </button>
                <button data-filter="today" class="filter-btn text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center gap-2">
                  <i class="fas fa-calendar-day"></i> Today
                </button>
                <button data-filter="upcoming" class="filter-btn text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center gap-2">
                  <i class="fas fa-calendar-week"></i> Upcoming
                </button>
                <button data-filter="completed" class="filter-btn text-left px-3 py-2 rounded-lg hover:bg-indigo-50 flex items-center gap-2">
                  <i class="fas fa-check-circle"></i> Completed
                </button>
              </nav>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold mb-3 text-lg">Quick Add</h3>
              <div class="space-y-3">
                <input id="taskTitle" placeholder="Task title" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <input id="taskDue" type="datetime-local" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <div class="flex gap-2">
                  <select id="taskPriority" class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="Low">Low</option>
                    <option value="Medium" selected>Medium</option>
                    <option value="High">High</option>
                  </select>
                  <select id="taskRepeat" class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="none">No repeat</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </div>
                <input id="taskTags" placeholder="tags,comma,separated" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <textarea id="taskNotes" placeholder="Notes (optional)" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2"></textarea>
                <div class="flex gap-2">
                  <button id="addTaskBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex-1">
                    <i class="fas fa-plus mr-2"></i> Add Task
                  </button>
                  <button id="resetFormBtn" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                    <i class="fas fa-redo"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold mb-3 text-lg">Stats</h3>
              <p class="text-sm mb-1">Total: <strong id="totalTasks">0</strong></p>
              <p class="text-sm mb-1">Pending: <strong id="pendingTasks">0</strong></p>
              <p class="text-sm">Completed: <strong id="completedTasks">0</strong></p>
            </div>
          </aside>

          <section class="md:col-span-2">
            <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
              <h2 class="font-semibold text-lg mb-3" id="viewTitle">All Tasks</h2>

              <div class="space-y-3" id="tasksContainer">
                <!-- Tasks will be rendered here -->
                <div class="text-center py-8 text-gray-500">
                  <i class="fas fa-tasks text-4xl mb-3"></i>
                  <p>No tasks yet. Add your first task!</p>
                </div>
              </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <h3 class="font-semibold mb-3 text-lg">Recently Completed</h3>
              <div class="space-y-2" id="completedContainer">
                <!-- Completed tasks will be rendered here -->
                <div class="text-center py-4 text-gray-500">
                  <p>No completed tasks yet.</p>
                </div>
              </div>
            </div>
          </section>
        </main>

        <footer class="text-center text-sm text-gray-500 mt-8">
          Made with ❤️ — Your tasks are securely stored in Firebase.
        </footer>
      </div>
    </div>
  </div>

  <!-- Firebase App (the core Firebase SDK is always required) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <!-- Firebase Authentication -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDe8yzLDj8Y-gzHqS2arkwbD989LwIO4DQ",
      authDomain: "todoapp-5d6ec.firebaseapp.com",
      databaseURL: "https://todoapp-5d6ec-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "todoapp-5d6ec",
      storageBucket: "todoapp-5d6ec.firebasestorage.app",
      messagingSenderId: "720430702785",
      appId: "1:720430702785:web:af612a4935cdc731ccb440",
      measurementId: "G-YG48X4LZ97"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM elements
    const authSection = document.getElementById('authSection');
    const appSection = document.getElementById('appSection');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const resetForm = document.getElementById('resetForm');
    const authError = document.getElementById('authError');
    const authSuccess = document.getElementById('authSuccess');
    const userEmailDisplay = document.getElementById('userEmailDisplay');
    
    // Auth navigation
    document.getElementById('showSignup').addEventListener('click', () => {
      loginForm.classList.add('hidden');
      resetForm.classList.add('hidden');
      signupForm.classList.remove('hidden');
    });
    
    document.getElementById('showLogin').addEventListener('click', () => {
      signupForm.classList.add('hidden');
      resetForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
    });
    
    document.getElementById('showReset').addEventListener('click', () => {
      loginForm.classList.add('hidden');
      signupForm.classList.add('hidden');
      resetForm.classList.remove('hidden');
    });
    
    document.getElementById('showLoginFromReset').addEventListener('click', () => {
      resetForm.classList.add('hidden');
      signupForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
    });

    // Auth functions
    document.getElementById('loginBtn').addEventListener('click', () => {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        showAuthError('Please enter both email and password');
        return;
      }
      
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Signed in
          showAuthSuccess('Successfully signed in!');
          setTimeout(() => {
            authSection.classList.add('hidden');
            appSection.classList.remove('hidden');
            userEmailDisplay.textContent = userCredential.user.email;
            loadTasks();
          }, 1000);
        })
        .catch((error) => {
          showAuthError(error.message);
        });
    });

    document.getElementById('signupBtn').addEventListener('click', () => {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (!email || !password || !confirmPassword) {
        showAuthError('Please fill all fields');
        return;
      }
      
      if (password !== confirmPassword) {
        showAuthError('Passwords do not match');
        return;
      }
      
      if (password.length < 6) {
        showAuthError('Password should be at least 6 characters');
        return;
      }
      
      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Signed up
          showAuthSuccess('Account created successfully!');
          setTimeout(() => {
            authSection.classList.add('hidden');
            appSection.classList.remove('hidden');
            userEmailDisplay.textContent = userCredential.user.email;
          }, 1000);
        })
        .catch((error) => {
          showAuthError(error.message);
        });
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      const email = document.getElementById('resetEmail').value;
      
      if (!email) {
        showAuthError('Please enter your email address');
        return;
      }
      
      auth.sendPasswordResetEmail(email)
        .then(() => {
          showAuthSuccess('Password reset email sent! Check your inbox.');
        })
        .catch((error) => {
          showAuthError(error.message);
        });
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      auth.signOut().then(() => {
        appSection.classList.add('hidden');
        authSection.classList.remove('hidden');
        // Clear forms
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('confirmPassword').value = '';
        document.getElementById('resetEmail').value = '';
        // Hide error/success messages
        authError.classList.add('hidden');
        authSuccess.classList.add('hidden');
      });
    });

    // Helper functions
    function showAuthError(message) {
      authError.textContent = message;
      authError.classList.remove('hidden');
      authSuccess.classList.add('hidden');
    }

    function showAuthSuccess(message) {
      authSuccess.textContent = message;
      authSuccess.classList.remove('hidden');
      authError.classList.add('hidden');
    }

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
      const body = document.body;
      if (body.getAttribute('data-theme') === 'dark') {
        body.removeAttribute('data-theme');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      }
    });

    // Check for saved theme preference
    if (localStorage.getItem('theme') === 'dark') {
      document.body.setAttribute('data-theme', 'dark');
      document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
    }

    // Task management
    let tasks = [];
    let currentFilter = 'all';

    // Initialize task form with today's date
    document.getElementById('taskDue').value = new Date().toISOString().slice(0, 16);

    // Add task
    document.getElementById('addTaskBtn').addEventListener('click', addTask);
    document.getElementById('resetFormBtn').addEventListener('click', resetTaskForm);

    function addTask() {
      const title = document.getElementById('taskTitle').value.trim();
      if (!title) return;
      
      const user = auth.currentUser;
      if (!user) return;
      
      const task = {
        id: Date.now().toString(),
        title: title,
        notes: document.getElementById('taskNotes').value.trim(),
        due: document.getElementById('taskDue').value ? new Date(document.getElementById('taskDue').value).toISOString() : null,
        priority: document.getElementById('taskPriority').value,
        tags: document.getElementById('taskTags').value ? document.getElementById('taskTags').value.split(',').map(s => s.trim()).filter(Boolean) : [],
        completed: false,
        completedAt: null,
        repeat: document.getElementById('taskRepeat').value,
        createdAt: new Date().toISOString(),
        userId: user.uid
      };
      
      // Save to Firestore
      db.collection('tasks').doc(task.id).set(task)
        .then(() => {
          tasks.unshift(task);
          renderTasks();
          resetTaskForm();
          updateStats();
        })
        .catch((error) => {
          console.error('Error adding task: ', error);
        });
    }

    function resetTaskForm() {
      document.getElementById('taskTitle').value = '';
      document.getElementById('taskNotes').value = '';
      document.getElementById('taskDue').value = new Date().toISOString().slice(0, 16);
      document.getElementById('taskPriority').value = 'Medium';
      document.getElementById('taskRepeat').value = 'none';
      document.getElementById('taskTags').value = '';
    }

    function toggleComplete(id) {
      const task = tasks.find(t => t.id === id);
      if (!task) return;
      
      const updatedTask = {
        ...task,
        completed: !task.completed,
        completedAt: task.completed ? null : new Date().toISOString()
      };
      
      // Handle recurring tasks
      if (!task.completed && task.repeat !== 'none') {
        const nextDue = computeNextDue(task.due, task.repeat);
        if (nextDue) {
          const nextTask = {
            ...task,
            id: Date.now().toString(),
            completed: false,
            completedAt: null,
            due: nextDue,
            createdAt: new Date().toISOString()
          };
          
          db.collection('tasks').doc(nextTask.id).set(nextTask)
            .then(() => {
              tasks.unshift(nextTask);
            })
            .catch((error) => {
              console.error('Error adding recurring task: ', error);
            });
        }
      }
      
      // Update in Firestore
      db.collection('tasks').doc(id).update(updatedTask)
        .then(() => {
          const index = tasks.findIndex(t => t.id === id);
          if (index !== -1) {
            tasks[index] = updatedTask;
            renderTasks();
            updateStats();
          }
        })
        .catch((error) => {
          console.error('Error updating task: ', error);
        });
    }

    function computeNextDue(iso, repeat) {
      if (!iso) return null;
      const dt = new Date(iso);
      if (repeat === 'daily') dt.setDate(dt.getDate() + 1);
      else if (repeat === 'weekly') dt.setDate(dt.getDate() + 7);
      else if (repeat === 'monthly') dt.setMonth(dt.getMonth() + 1);
      else if (repeat === 'yearly') dt.setFullYear(dt.getFullYear() + 1);
      return dt.toISOString();
    }

    function deleteTask(id) {
      if (!confirm('Are you sure you want to delete this task?')) return;
      
      db.collection('tasks').doc(id).delete()
        .then(() => {
          tasks = tasks.filter(t => t.id !== id);
          renderTasks();
          updateStats();
        })
        .catch((error) => {
          console.error('Error deleting task: ', error);
        });
    }

    function snoozeTask(id, days = 1) {
      const task = tasks.find(t => t.id === id);
      if (!task) return;
      
      const newDue = task.due 
        ? new Date(new Date(task.due).getTime() + days * 24 * 3600 * 1000).toISOString()
        : new Date(Date.now() + days * 24 * 3600 * 1000).toISOString();
      
      const updatedTask = {
        ...task,
        due: newDue
      };
      
      db.collection('tasks').doc(id).update(updatedTask)
        .then(() => {
          const index = tasks.findIndex(t => t.id === id);
          if (index !== -1) {
            tasks[index] = updatedTask;
            renderTasks();
          }
        })
        .catch((error) => {
          console.error('Error snoozing task: ', error);
        });
    }

    function loadTasks() {
      const user = auth.currentUser;
      if (!user) return;
      
      db.collection('tasks')
        .where('userId', '==', user.uid)
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          tasks = [];
          snapshot.forEach((doc) => {
            tasks.push(doc.data());
          });
          renderTasks();
          updateStats();
        }, (error) => {
          console.error('Error loading tasks: ', error);
        });
    }

    function renderTasks() {
      const tasksContainer = document.getElementById('tasksContainer');
      const completedContainer = document.getElementById('completedContainer');
      
      // Filter tasks based on current view
      let filteredTasks = tasks.filter(task => {
        if (currentFilter === 'completed') return task.completed;
        if (task.completed) return false;
        
        if (currentFilter === 'inbox') return !task.due;
        if (currentFilter === 'today') return isToday(task.due);
        if (currentFilter === 'upcoming') return task.due && new Date(task.due) > new Date();
        
        return true; // 'all' filter
      });
      
      // Render main tasks
      if (filteredTasks.length === 0) {
        tasksContainer.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-tasks text-4xl mb-3"></i>
            <p>No tasks found.</p>
          </div>
        `;
      } else {
        tasksContainer.innerHTML = filteredTasks.map(task => `
          <div class="border rounded-lg p-4 flex items-start gap-3 fade-in">
            <div class="flex-shrink-0 mt-1">
              <input type="checkbox" ${task.completed ? 'checked' : ''} 
                onchange="toggleComplete('${task.id}')" 
                class="task-checkbox w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="task-title font-medium ${task.completed ? 'line-through text-gray-400' : ''}">${task.title}</h3>
                  ${task.notes ? `<p class="text-sm text-gray-500 mt-1">${task.notes}</p>` : ''}
                </div>
                <div class="text-right">
                  ${task.due ? `<div class="text-sm">${formatDateTime(task.due)}</div>` : '<div class="text-sm text-gray-400">No due</div>'}
                  <div class="text-xs mt-1 priority-${task.priority.toLowerCase()}">${task.priority}</div>
                </div>
              </div>
              <div class="mt-3 flex items-center justify-between">
                <div class="flex gap-2 items-center">
                  ${task.tags.map(tag => `
                    <span class="text-xs px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full">${tag}</span>
                  `).join('')}
                </div>
                <div class="flex gap-2">
                  <button onclick="snoozeTask('${task.id}', 1)" class="text-xs px-2 py-1 border border-gray-300 rounded-lg hover:bg-gray-100">Snooze 1d</button>
                  <button onclick="deleteTask('${task.id}')" class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      // Render completed tasks
      const completedTasks = tasks.filter(t => t.completed).slice(0, 5);
      if (completedTasks.length === 0) {
        completedContainer.innerHTML = `
          <div class="text-center py-4 text-gray-500">
            <p>No completed tasks yet.</p>
          </div>
        `;
      } else {
        completedContainer.innerHTML = completedTasks.map(task => `
          <div class="text-sm text-gray-600 flex justify-between items-center py-2 border-b border-gray-100">
            <div class="line-through">${task.title}</div>
            <div class="text-xs">${formatDateTime(task.completedAt)}</div>
          </div>
        `).join('');
      }
    }

    function updateStats() {
      document.getElementById('totalTasks').textContent = tasks.length;
      document.getElementById('pendingTasks').textContent = tasks.filter(t => !t.completed).length;
      document.getElementById('completedTasks').textContent = tasks.filter(t => t.completed).length;
    }

    function isToday(iso) {
      if (!iso) return false;
      const d = new Date(iso);
      const now = new Date();
      return d.getFullYear() === now.getFullYear() && 
             d.getMonth() === now.getMonth() && 
             d.getDate() === now.getDate();
    }

    function formatDateTime(iso) {
      if (!iso) return '';
      const date = new Date(iso);
      return date.toLocaleString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Filter tasks
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentFilter = btn.getAttribute('data-filter');
        document.querySelectorAll('.filter-btn').forEach(b => {
          b.classList.remove('bg-indigo-100', 'text-indigo-600');
        });
        btn.classList.add('bg-indigo-100', 'text-indigo-600');
        
        // Update view title
        const viewTitle = document.getElementById('viewTitle');
        if (currentFilter === 'all') viewTitle.textContent = 'All Tasks';
        else if (currentFilter === 'inbox') viewTitle.textContent = 'Inbox';
        else if (currentFilter === 'today') viewTitle.textContent = 'Today';
        else if (currentFilter === 'upcoming') viewTitle.textContent = 'Upcoming';
        else if (currentFilter === 'completed') viewTitle.textContent = 'Completed';
        
        renderTasks();
      });
    });

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const taskElements = document.querySelectorAll('#tasksContainer > div');
      
      taskElements.forEach(el => {
        const title = el.querySelector('.task-title').textContent.toLowerCase();
        const notes = el.querySelector('p') ? el.querySelector('p').textContent.toLowerCase() : '';
        const tags = Array.from(el.querySelectorAll('span')).map(span => span.textContent.toLowerCase()).join(' ');
        
        if (title.includes(query) || notes.includes(query) || tags.includes(query)) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      });
    });

    // Make functions available globally for onclick handlers
    window.toggleComplete = toggleComplete;
    window.deleteTask = deleteTask;
    window.snoozeTask = snoozeTask;

    // Auth state observer
    auth.onAuthStateChanged((user) => {
      if (user) {
        authSection.classList.add('hidden');
        appSection.classList.remove('hidden');
        userEmailDisplay.textContent = user.email;
        loadTasks();
      } else {
        appSection.classList.add('hidden');
        authSection.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>